<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <title>Beacon Delegation Example</title>
    <!--
      This import might be blocked by ad-blockers.
      To fix this, you can download the walletbeacon.min.js file,
      host it yourself and replace the import.
    -->
    <script src="https://unpkg.com/@airgap/beacon-sdk@1.1.1/dist/walletbeacon.min.js"></script>
  </head>

  <body>
    Beacon Delegation Example
    <button id="connect">Connect and Delegate</button>

    <script>
      const bakerAddress = 'tz1MJx9vhaNRSimcuXPK2rW4fLccQnDAnVKJ' // Replace with baker address
      const bakerName = 'Delegation Example DApp' // Replace with baker name / website

      // Initiate DAppClient
      const client = new beacon.DAppClient({
        name: bakerName
      })

      const delegate = () => {
        client.requestOperation({
          operationDetails: [{ kind: beacon.TezosOperationType.DELEGATION, delegate: bakerAddress }]
        })
      }

      // Add event listener to the button
      document.getElementById('connect').addEventListener('click', () => {
        // Check if we have an active account
        client.getActiveAccount().then((activeAccount) => {
          if (activeAccount) {
            // If we have an active account, send the delegate operation directly
            delegate()
          } else {
            // If we don't have an active account, we need to request permissions first and then send the delegate operation
            client.requestPermissions().then((permissions) => {
              delegate()
            })
          }
        })
      })
    </script>
  </body>
</html>
